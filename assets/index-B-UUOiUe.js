(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function M(t,n,e,o=6,i=6){const r=c=>{let h=0,u=0;for(;h===0;)h=Math.random();for(;u===0;)u=Math.random();return Math.round(Math.cos(2*Math.PI*h)*Math.sqrt(-2*Math.log(u))*c)};let s=Math.max(-o,Math.min(o,r(n))),d=Math.max(-i,Math.min(i,r(n))),l=Math.max(0,Math.min(e.width-1,t.x+s)),a=Math.max(0,Math.min(e.height-1,t.y+d));return{x:l,y:a}}function m(t){return Math.floor(Math.random()*t)}async function w(t,n){const e=[];for(let s=0;s<t.baseCount;s++)e.push({id:s+1,position:{x:Math.floor(t.width/2),y:t.height-1},capacity:t.droneCount,unspawned:t.droneCount});const o=[],i=[];for(let s=0;s<t.casualtyCount;s++){const d={x:m(t.width),y:m(Math.floor(t.height*.66))},l=M(d,2,{width:t.width,height:t.height});i.push({id:s+1,estimatedPosition:d,position:l})}const r={bases:e,drones:o,casualties:i};return n!=null&&n.beforeSimStart&&await n.beforeSimStart({cfg:t,state:r}),n!=null&&n.afterSimStart&&await n.afterSimStart({cfg:t,state:r}),{width:t.width,height:t.height,bases:e,drones:o,casualties:i}}const f={base:"#5b6977",drone:"#fff",casualty:"#f43f5e",estimated:"#f59e42"};function x(t,n,e,o){t.fillStyle=e,t.fillRect(n.x-o/2,n.y-o/2,o,o)}function y(t,n,e,o){t.fillStyle=e,t.beginPath(),t.arc(n.x,n.y,o,0,Math.PI*2),t.fill()}function b(t,n,e,o){t.strokeStyle=e,t.lineWidth=3,t.beginPath(),t.moveTo(n.x-o,n.y-o),t.lineTo(n.x+o,n.y+o),t.moveTo(n.x+o,n.y-o),t.lineTo(n.x-o,n.y+o),t.stroke()}function g(t,n){const e=t.getContext("2d"),o=t.width,i=t.height,{width:r,height:s}=n,d=o/r,l=i/s;e.clearRect(0,0,o,i),e.strokeStyle="#1d2733",e.lineWidth=1;for(let a=0;a<=r;a++){const c=Math.round(a*d)+.5;e.beginPath(),e.moveTo(c,.5),e.lineTo(c,i+.5),e.stroke()}for(let a=0;a<=s;a++){const c=Math.round(a*l)+.5;e.beginPath(),e.moveTo(.5,c),e.lineTo(o+.5,c),e.stroke()}for(const a of n.bases){const c=(a.position.x+.5)*d,h=(a.position.y+.5)*l,u=Math.min(d,l)*.7;x(e,{x:c,y:h},f.base,u),e.fillStyle="#fff",e.font=`${Math.round(u*.5)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(`${a.unspawned??0}`,c,h)}for(const a of n.drones){if(!a.spawned)continue;const c=(a.position.x+.5)*d,h=(a.position.y+.5)*l;y(e,{x:c,y:h},f.drone,Math.min(d,l)*.28),e.fillStyle="#222",e.font=`${Math.round(Math.max(d,l)*.23)}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillText(`${a.id}`,c,h)}for(const a of n.casualties)b(e,{x:(a.estimatedPosition.x+.5)*d,y:(a.estimatedPosition.y+.5)*l},f.estimated,Math.min(d,l)*.22),y(e,{x:(a.position.x+.5)*d,y:(a.position.y+.5)*l},f.casualty,Math.min(d,l)*.18)}const p=document.getElementById("main-canvas"),S=document.getElementById("sidebar-key"),v=document.getElementById("top-bar"),P=document.getElementById("bottom-bar"),C={width:50,height:40,baseCount:1,droneCount:4,casualtyCount:1};function T(t,n){const e=window.devicePixelRatio||1,o=800,i=Math.round(o*(n.width/n.height));t.style.width=i+"px",t.style.height=o+"px",t.width=Math.round(i*e),t.height=Math.round(o*e)}window.onload=async()=>{v.textContent="MASAR Demo",P.textContent=`Â© Steve Marvell ${new Date().getFullYear()}`,S.innerHTML=`
    <div style="margin-bottom:8px;"><strong>Key</strong></div>
    <div><span class="key base"></span>Base</div>
    <div><span class="key drone"></span>Drone</div>
    <div><span class="key est"></span>Estimated Position</div>
    <div><span class="key cas"></span>Actual Casualty</div>
  `;const t=await w(C,{beforeSimStart:({cfg:n})=>T(p,n)});g(p,t)};
